#!/bin/bash -eu

tag="snap.$SNAP_INSTANCE_NAME.hook.configure"

# Redirect stdout to stdout+syslog
exec 1> >(tee >(logger --tag=$tag))
# Redirect stderr to stderr+syslog
exec 2> >(logger --stderr --priority error --tag=$tag)

stack="$(snapctl get stack)"
if [ -n "$stack" ]; then
    # Validate user input and apply stack config
    stack select "$stack"
else
    echo "Stack not set! Will auto select a stack ..."

    if snapctl is-connected hardware-observe
    then
        stack select --auto
    else
        # We skip the auto selection if hardware-observe interface is not auto connected.
        # In such case, the user is expected to manually connect and call any of the apps.
        # The initialization will perform auto selection if no stack is set.
        echo "Skip auto selection: hardware-observe interface required but not connected."
    fi
fi
